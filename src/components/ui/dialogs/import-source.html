<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Select Import Source</title>
  <link rel="stylesheet" href="../../../assets/css/tailwind.output.css">
</head>
<body>
  <div class="h-full flex flex-col bg-primary p-4 rounded-lg border border-accent">
    <div class="flex flex-col space-y-2">
      <button onclick="console.log('Atlas button clicked');window.electronAPI.openImporter('local').then(response => {console.log('openImporter response:', response);setTimeout(() => {window.electronAPI.closeWindow().then(res => console.log('closeWindow response:', res)).catch(err => console.error('Close window error:', err));}, 1000);}).catch(err => console.error('Atlas error:', err));" 
              class="bg-secondary hover:bg-selected text-text p-2 rounded">
        Atlas Game Importer
      </button>
      <button id="steam-import-btn" class="bg-secondary hover:bg-selected text-text p-2 rounded">Import Steam Games</button>
    </div>
  </div>
  <script>
    console.log('import-source.html script context loaded');
    function startSteamScan() {
      console.log('Steam button clicked');
      window.electronAPI.startSteamScan({
        downloadBannerImages: false,
        downloadPreviewImages: false,
        previewLimit: '5',
        downloadVideos: false
      }).then(result => {
        console.log('Steam scan result:', result);
        if (result.success) {
          window.electronAPI.openImporter('steam').then(() => {
            setTimeout(() => {
              window.electronAPI.closeWindow().then(res => console.log('closeWindow response:', res)).catch(err => console.error('Close window error:', err));
            }, 1000);
          }).catch(err => console.error('Open importer error:', err));
        } else if (result.error.includes('No Steam games found')) {
          console.log('Prompting for Steam directory');
        } else {
          alert('Error scanning Steam games: ' + result.error);
        }
      }).catch(err => console.error('Steam error:', err));
    }
    document.getElementById('steam-import-btn').onclick = startSteamScan;
    window.electronAPI.onPromptSteamDirectory(() => {
      console.log('Received prompt-steam-directory event');
      window.electronAPI.selectSteamDirectory().then(path => {
        if (path) {
          console.log(`Selected Steam directory: ${path}`);
          startSteamScan();
        } else {
          alert('No Steam directory selected');
        }
      }).catch(err => console.error('Directory selection error:', err));
    });
  </script>
</body>
</html>